# IngredientIQ™ Admin Panel - Enterprise Process Flow
**Version:** 1.0  
**Date:** January 8, 2026

---

## 1. System Architecture Overview

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              INGREDIENTIQ™ ADMIN PANEL                               │
│                              Enterprise Architecture                                 │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────┐     HTTPS/WSS      ┌──────────────────┐     SQL        ┌──────────────┐
│                  │ ◄──────────────────► │                  │ ◄────────────► │              │
│  React Frontend  │     REST API        │  Django Backend  │   ORM/Queries  │   SQLite/    │
│  (Control Panel) │                     │  (DRF + JWT)     │                │   PostgreSQL │
│                  │                     │                  │                │              │
└──────────────────┘                     └────────┬─────────┘                └──────────────┘
                                                  │
                                                  │ Email
                                                  ▼
                                         ┌──────────────────┐
                                         │   SMTP Server    │
                                         │  (OTP Delivery)  │
                                         └──────────────────┘
```

---

## 2. Authentication Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                           ADMIN AUTHENTICATION WORKFLOW                              │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────┐          ┌─────────────┐          ┌──────────────┐          ┌─────────────┐
│  Admin  │          │   React     │          │   Django     │          │  Database   │
│  User   │          │   Frontend  │          │   Backend    │          │             │
└────┬────┘          └──────┬──────┘          └──────┬───────┘          └──────┬──────┘
     │                      │                        │                          │
     │ 1. Enter credentials │                        │                          │
     │─────────────────────►│                        │                          │
     │                      │                        │                          │
     │                      │ 2. POST /master/login/ │                          │
     │                      │───────────────────────►│                          │
     │                      │   {email, password}    │                          │
     │                      │                        │                          │
     │                      │                        │ 3. Query SuperAdmin      │
     │                      │                        │─────────────────────────►│
     │                      │                        │                          │
     │                      │                        │ 4. Verify is_super_admin │
     │                      │                        │◄─────────────────────────│
     │                      │                        │                          │
     │                      │                        │ 5. check_password()      │
     │                      │                        │─────────────────────────►│
     │                      │                        │                          │
     │                      │ 6. JWT Tokens          │                          │
     │                      │◄───────────────────────│                          │
     │                      │ {access_token,         │                          │
     │                      │  refresh_token}        │                          │
     │                      │                        │                          │
     │ 7. Redirect to       │                        │                          │
     │    Dashboard         │                        │                          │
     │◄─────────────────────│                        │                          │
     │                      │                        │                          │
```

### Token Lifecycle
```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  Access Token   │────►│    15-30 min    │────►│     Expired     │
│  (Short-lived)  │     │   Valid Period  │     │  Needs Refresh  │
└─────────────────┘     └─────────────────┘     └────────┬────────┘
                                                         │
                                                         ▼
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  Refresh Token  │────►│     24 hours    │────►│  Force Re-login │
│  (Long-lived)   │     │   Valid Period  │     │                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

---

## 3. Password Recovery Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                           PASSWORD RECOVERY WORKFLOW                                 │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────┐     ┌─────────────┐     ┌──────────────┐     ┌─────────┐     ┌──────────┐
│  Admin  │     │   Frontend  │     │   Backend    │     │   SMTP  │     │  Email   │
│  User   │     │             │     │              │     │  Server │     │  Inbox   │
└────┬────┘     └──────┬──────┘     └──────┬───────┘     └────┬────┘     └────┬─────┘
     │                 │                   │                  │               │
     │ 1. Click        │                   │                  │               │
     │    "Forgot"     │                   │                  │               │
     │────────────────►│                   │                  │               │
     │                 │                   │                  │               │
     │                 │ 2. POST           │                  │               │
     │                 │ /forgotpassword/  │                  │               │
     │                 │──────────────────►│                  │               │
     │                 │                   │                  │               │
     │                 │                   │ 3. Generate      │               │
     │                 │                   │    6-digit OTP   │               │
     │                 │                   │──────────────────│               │
     │                 │                   │                  │               │
     │                 │                   │ 4. Send OTP      │               │
     │                 │                   │─────────────────►│               │
     │                 │                   │                  │               │
     │                 │                   │                  │ 5. Deliver    │
     │                 │                   │                  │──────────────►│
     │                 │                   │                  │               │
     │ 6. Check email  │                   │                  │               │
     │◄────────────────────────────────────────────────────────────────────────│
     │                 │                   │                  │               │
     │ 7. Enter OTP    │                   │                  │               │
     │    + new pass   │                   │                  │               │
     │────────────────►│                   │                  │               │
     │                 │                   │                  │               │
     │                 │ 8. POST           │                  │               │
     │                 │ /changepassword/  │                  │               │
     │                 │──────────────────►│                  │               │
     │                 │                   │                  │               │
     │                 │                   │ 9. Verify OTP    │               │
     │                 │                   │    & Update Pass │               │
     │                 │                   │──────────────────│               │
     │                 │                   │                  │               │
     │                 │ 10. Success       │                  │               │
     │                 │◄──────────────────│                  │               │
     │                 │                   │                  │               │
     │ 11. Redirect    │                   │                  │               │
     │     to Login    │                   │                  │               │
     │◄────────────────│                   │                  │               │
```

---

## 4. User Management Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                            USER MANAGEMENT WORKFLOW                                  │
└─────────────────────────────────────────────────────────────────────────────────────┘

                              ┌─────────────────┐
                              │   Admin Views   │
                              │   User List     │
                              └────────┬────────┘
                                       │
                    ┌──────────────────┼──────────────────┐
                    │                  │                  │
                    ▼                  ▼                  ▼
          ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
          │   View User     │ │   Edit User     │ │  Delete User    │
          │   Details       │ │   Profile       │ │                 │
          └────────┬────────┘ └────────┬────────┘ └────────┬────────┘
                   │                   │                   │
                   ▼                   ▼                   ▼
          ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
          │ GET /users/     │ │ PATCH /users/   │ │ DELETE /users/  │
          │                 │ │ ?id={user_id}   │ │ ?id={user_id}   │
          └────────┬────────┘ └────────┬────────┘ └────────┬────────┘
                   │                   │                   │
                   ▼                   ▼                   ▼
          ┌─────────────────────────────────────────────────────────┐
          │                     Database Operations                  │
          │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐  │
          │  │ User Table  │  │ Subscription│  │ Related Tables  │  │
          │  │             │  │   Table     │  │ (FK Cleanup)    │  │
          │  └─────────────┘  └─────────────┘  └─────────────────┘  │
          └─────────────────────────────────────────────────────────┘
```

### User Delete Cascade
```
DELETE User
    ├── UserHealthPreference
    ├── StripeCustomer
    ├── FoodLabelScan
    ├── Feedback
    ├── MonthlyScanUsage
    ├── PushNotification
    ├── DeviceToken
    ├── UserSubscription
    ├── AccountDeletionRequest
    ├── OnboardingAnswer
    ├── SuperAdmin (if admin)
    └── User Groups/Permissions
```

---

## 5. Content Management Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                          CONTENT MANAGEMENT WORKFLOW                                 │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────────────┐
│                              Admin Content Dashboard                               │
└───────────────────────────────────────────────────────────────────────────────────┘
                                        │
        ┌───────────────┬───────────────┼───────────────┬───────────────┐
        │               │               │               │               │
        ▼               ▼               ▼               ▼               ▼
┌───────────────┐ ┌───────────────┐ ┌───────────────┐ ┌───────────────┐ ┌───────────────┐
│ Privacy Policy│ │ Terms & Conds │ │     FAQ       │ │   About Us    │ │  Onboarding   │
│               │ │               │ │               │ │               │ │               │
│ /privacypolicy│ │/Termsandcond  │ │ /FAQ          │ │ /Aboutus      │ │ /onboarding/* │
└───────┬───────┘ └───────┬───────┘ └───────┬───────┘ └───────┬───────┘ └───────┬───────┘
        │                 │                 │                 │                 │
        │                 │                 │                 │                 │
        ▼                 ▼                 ▼                 ▼                 ▼
┌───────────────────────────────────────────────────────────────────────────────────┐
│                              CRUD Operations Matrix                                │
│                                                                                    │
│   GET    ─────► Retrieve content (list or single)                                 │
│   POST   ─────► Create new content entry                                          │
│   PUT    ─────► Update existing content (?pk={id})                                │
│   DELETE ─────► Remove content entry (?pk={id})                                   │
│                                                                                    │
└───────────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. Onboarding System Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                            ONBOARDING MANAGEMENT SYSTEM                              │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              ADMIN: Question Management                              │
└─────────────────────────────────────────────────────────────────────────────────────┘

          ┌──────────────────────────────────────────────────────────────┐
          │                    OnboardingQuestion                        │
          │   ┌─────────────┐ ┌─────────────┐ ┌────────────────────────┐ │
          │   │ question_   │ │ answer_type │ │      category          │ │
          │   │ text        │ │ single/     │ │ (17 predefined types)  │ │
          │   │             │ │ multiple    │ │                        │ │
          │   └─────────────┘ └─────────────┘ └────────────────────────┘ │
          └──────────────────────────┬───────────────────────────────────┘
                                     │
                                     │ 1:N
                                     ▼
          ┌──────────────────────────────────────────────────────────────┐
          │                    OnboardingChoice                          │
          │   ┌─────────────────────┐  ┌─────────────────────────────┐   │
          │   │ choice_text         │  │ question (FK)               │   │
          │   └─────────────────────┘  └─────────────────────────────┘   │
          └──────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              MOBILE APP: Answer Collection                           │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   User      │     │   Mobile    │     │   Backend   │     │   User      │
│   Starts    │────►│   App       │────►│   POST      │────►│   Profile   │
│   Onboard   │     │   (Q1-Qn)   │     │  /answers/  │     │   Updated   │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
                                               │
                                               ▼
                          ┌──────────────────────────────────┐
                          │        Category Mapping          │
                          │                                  │
                          │  profile_demographics → Demographics
                          │  motivation_cognitive → Motivation
                          │  medical_clinical    → Health_conditions
                          │  medications_supplements → Medications
                          │  allergies_sensitivities → Allergies
                          │  lifestyle_dietary   → Dietary_preferences
                          │  behavioral_rhythm   → Behavioral_patterns
                          │                                  │
                          └──────────────────────────────────┘
```

### Onboarding Categories (Static)
```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ ID │ Category Key              │ AI Purpose                                        │
├────┼───────────────────────────┼───────────────────────────────────────────────────┤
│ 1  │ profile_demographics      │ Personalization & demographic targeting           │
│ 2  │ motivation_cognitive      │ Engagement optimization & messaging tone          │
│ 3  │ medical_clinical          │ Health risk assessment & ingredient filtering     │
│ 4  │ medications_supplements   │ Drug interaction warnings                         │
│ 5  │ allergies_sensitivities   │ Critical allergen detection & alerts              │
│ 6  │ lifestyle_dietary         │ Dietary recommendation engine                     │
│ 7  │ behavioral_rhythm         │ Notification timing & frequency                   │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. API Request/Response Cycle

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                            API REQUEST LIFECYCLE                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌──────────┐                                                           ┌──────────┐
│  Client  │                                                           │  Client  │
│ Request  │                                                           │ Response │
└────┬─────┘                                                           └────▲─────┘
     │                                                                      │
     │ ┌─────────────────────────────────────────────────────────────────┐  │
     │ │                     MIDDLEWARE STACK                            │  │
     │ │  ┌────────────────┐ ┌────────────────┐ ┌────────────────────┐  │  │
     └─┼─►│ Security       │►│ CORS           │►│ Authentication     │──┼──┘
       │  │ Headers        │ │ Middleware     │ │ Middleware         │  │
       │  └────────────────┘ └────────────────┘ └────────────────────┘  │
       └─────────────────────────────┬───────────────────────────────────┘
                                     │
                                     ▼
       ┌─────────────────────────────────────────────────────────────────┐
       │                      URL ROUTER                                  │
       │                                                                  │
       │   /master/* ─────────────► panel.urls                           │
       │   /foodapp/* ────────────► foodinfo.urls                        │
       │   /web/* ────────────────► Website.urls                         │
       │   /control-panel/* ──────► serve_react_admin_panel              │
       │                                                                  │
       └─────────────────────────────┬───────────────────────────────────┘
                                     │
                                     ▼
       ┌─────────────────────────────────────────────────────────────────┐
       │                      VIEW PROCESSING                             │
       │  ┌────────────────┐ ┌────────────────┐ ┌────────────────────┐   │
       │  │ Permission     │►│ Serializer     │►│ Model/DB           │   │
       │  │ Check          │ │ Validation     │ │ Operations         │   │
       │  └────────────────┘ └────────────────┘ └────────────────────┘   │
       └─────────────────────────────┬───────────────────────────────────┘
                                     │
                                     ▼
       ┌─────────────────────────────────────────────────────────────────┐
       │                   STANDARDIZED RESPONSE                          │
       │                                                                  │
       │   SUCCESS:  { success: true,  message: "...", data: {...} }     │
       │   ERROR:    { success: false, message: "...", errors: {...} }   │
       │                                                                  │
       └─────────────────────────────────────────────────────────────────┘
```

---

## 8. Data Flow: User Subscription Query

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                       USER LIST WITH SUBSCRIPTION DATA                               │
└─────────────────────────────────────────────────────────────────────────────────────┘

GET /master/users/
        │
        ▼
┌───────────────────────────────────────┐
│ 1. Query User.objects.filter(         │
│       is_superuser=False)             │
│    .order_by('-created_at')           │
└───────────────────┬───────────────────┘
                    │
                    ▼
┌───────────────────────────────────────┐
│ 2. Serialize with userGetSerializer   │
└───────────────────┬───────────────────┘
                    │
                    ▼
┌───────────────────────────────────────┐
│ 3. For each user:                     │
│    ├── Query UserSubscription         │
│    ├── Check is_premium property      │
│    └── Determine:                     │
│        ├── payment_status             │
│        ├── premium_type               │
│        └── subscription_plan          │
└───────────────────┬───────────────────┘
                    │
                    ▼
┌───────────────────────────────────────┐
│ 4. Return enriched user list          │
│    with accurate subscription data    │
└───────────────────────────────────────┘
```

---

## 9. Security Layers

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              SECURITY ARCHITECTURE                                   │
└─────────────────────────────────────────────────────────────────────────────────────┘

                              INTERNET
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ LAYER 1: TRANSPORT                                                                   │
│ ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│ │                            HTTPS/TLS 1.3                                         │ │
│ │                          (Railway SSL)                                           │ │
│ └─────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ LAYER 2: HEADERS                                                                     │
│ ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│ │  X-Content-Type-Options: nosniff                                                 │ │
│ │  X-Frame-Options: DENY                                                           │ │
│ │  X-XSS-Protection: 1; mode=block                                                 │ │
│ │  Strict-Transport-Security: max-age=31536000                                     │ │
│ └─────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ LAYER 3: CORS                                                                        │
│ ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│ │  Allowed Origins: ingredientiq.ai, localhost (dev)                              │ │
│ │  Allowed Methods: GET, POST, PUT, PATCH, DELETE                                 │ │
│ │  Credentials: Allowed                                                            │ │
│ └─────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ LAYER 4: AUTHENTICATION                                                              │
│ ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│ │  JWT Token Validation (Authorization: Bearer <token>)                            │ │
│ │  Token Signature: HS256                                                          │ │
│ │  Issuer Verification                                                             │ │
│ └─────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ LAYER 5: AUTHORIZATION                                                               │
│ ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│ │  Permission Classes:                                                             │ │
│ │    ├── IsAuthenticated (User logged in)                                         │ │
│ │    └── IsSuperAdmin (is_super_admin = True)                                     │ │
│ └─────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ LAYER 6: DATA                                                                        │
│ ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│ │  Password Hashing: PBKDF2 + SHA256 (Django default)                             │ │
│ │  Input Validation: DRF Serializers                                              │ │
│ │  SQL Injection Protection: Django ORM parameterized queries                     │ │
│ └─────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 10. Deployment Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              RAILWAY DEPLOYMENT                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                      │
│   ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐              │
│   │   GitHub Repo   │────►│   Railway CI    │────►│   Production    │              │
│   │                 │     │   (Nixpacks)    │     │   Deployment    │              │
│   └─────────────────┘     └─────────────────┘     └─────────────────┘              │
│                                                                                      │
│   Configuration Files:                                                               │
│   ┌─────────────────────────────────────────────────────────────────────────────┐   │
│   │  nixpacks.toml    - Build configuration                                     │   │
│   │  railway.json     - Railway settings                                        │   │
│   │  Procfile         - Web: gunicorn foodanalysis.wsgi                        │   │
│   │  requirements.txt - Python dependencies                                     │   │
│   └─────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                      │
│   Environment Variables:                                                             │
│   ┌─────────────────────────────────────────────────────────────────────────────┐   │
│   │  DJANGO_SECRET_KEY     - Production secret                                  │   │
│   │  DEBUG=False           - Production mode                                    │   │
│   │  ALLOWED_HOSTS         - ingredientiq.ai                                    │   │
│   │  DATABASE_URL          - PostgreSQL connection                              │   │
│   │  RAILWAY_PUBLIC_DOMAIN - Auto-set by Railway                               │   │
│   └─────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 11. Error Handling Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              ERROR HANDLING STRATEGY                                 │
└─────────────────────────────────────────────────────────────────────────────────────┘

                         API Request
                              │
                              ▼
                    ┌─────────────────┐
                    │  Try Operation  │
                    └────────┬────────┘
                             │
              ┌──────────────┴──────────────┐
              │                             │
         SUCCESS                        EXCEPTION
              │                             │
              ▼                             ▼
    ┌─────────────────┐          ┌─────────────────┐
    │ success_response│          │  Catch & Handle │
    │ {                │          │                 │
    │   success: true, │          └────────┬────────┘
    │   message: "...",│                   │
    │   data: {...}    │       ┌───────────┼───────────┐
    │ }                │       │           │           │
    └─────────────────┘        ▼           ▼           ▼
                        ┌──────────┐ ┌──────────┐ ┌──────────┐
                        │Validation│ │ NotFound │ │ Generic  │
                        │  Error   │ │  Error   │ │  Error   │
                        └────┬─────┘ └────┬─────┘ └────┬─────┘
                             │            │            │
                             └──────┬─────┴──────┬─────┘
                                    │            │
                                    ▼            ▼
                         ┌──────────────────────────────┐
                         │       error_response         │
                         │ {                            │
                         │   success: false,            │
                         │   message: "Error desc",     │
                         │   errors: {field: [...]}     │
                         │ }                            │
                         └──────────────────────────────┘
```

---

*Process Flow Documentation - IngredientIQ™ Admin Panel*  
*Generated: January 8, 2026*
