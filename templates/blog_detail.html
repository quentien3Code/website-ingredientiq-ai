<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>{{ meta_title }} | IngredientIQ</title>
    <meta name="title" content="{{ meta_title }} | IngredientIQ">
    <meta name="description" content="{{ meta_description }}">
    <meta name="author" content="{{ author_name }}">
    {% if not blog.robots_indexable %}<meta name="robots" content="noindex{% if not blog.robots_followable %}, nofollow{% endif %}">{% endif %}
    <link rel="canonical" href="{{ canonical_url }}">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="{{ og_url }}">
    <meta property="og:title" content="{{ og_title }}">
    <meta property="og:description" content="{{ og_description }}">
    <meta property="og:image" content="{{ og_image }}">
    <meta property="og:site_name" content="IngredientIQ">
    <meta property="article:published_time" content="{{ publish_date|date:'c' }}">
    <meta property="article:modified_time" content="{{ modified_date|date:'c' }}">
    <meta property="article:author" content="{{ author_name }}">
    <meta property="article:section" content="{{ category_name }}">
    {% for tag in blog.tags.all %}<meta property="article:tag" content="{{ tag.name }}">{% endfor %}
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{{ og_url }}">
    <meta name="twitter:title" content="{{ twitter_title }}">
    <meta name="twitter:description" content="{{ twitter_description }}">
    <meta name="twitter:image" content="{{ og_image }}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/logo192.png">
    <link rel="apple-touch-icon" href="/logo192.png">
    
    <!-- Preload critical assets -->
    {% if blog.image %}<link rel="preload" as="image" href="{{ blog.get_image_url }}">{% endif %}
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": "{{ meta_title|escapejs }}",
        "description": "{{ meta_description|escapejs }}",
        "image": "{{ og_image }}",
        "author": {
            "@type": "Person",
            "name": "{{ author_name|escapejs }}"
        },
        "publisher": {
            "@type": "Organization",
            "name": "IngredientIQ",
            "logo": {
                "@type": "ImageObject",
                "url": "{{ site_url }}/logo512.png"
            }
        },
        "datePublished": "{{ publish_date|date:'c' }}",
        "dateModified": "{{ modified_date|date:'c' }}",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "{{ canonical_url }}"
        },
        "articleSection": "{{ category_name|escapejs }}"
    }
    </script>
    
    <style>
        /* Critical CSS for above-the-fold content */
        :root {
            --primary: #10b981;
            --text: #1f2937;
            --bg: #ffffff;
            --muted: #6b7280;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            line-height: 1.6; 
            color: var(--text);
            background: var(--bg);
        }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        article { padding: 40px 0; }
        header { margin-bottom: 32px; }
        h1 { font-size: 2.5rem; line-height: 1.2; margin-bottom: 16px; }
        .meta { color: var(--muted); font-size: 0.9rem; margin-bottom: 24px; }
        .meta span { margin-right: 16px; }
        .featured-image { width: 100%; max-height: 500px; object-fit: cover; border-radius: 8px; margin-bottom: 32px; }
        .content { font-size: 1.1rem; }
        .content h2 { margin-top: 2rem; margin-bottom: 1rem; font-size: 1.75rem; }
        .content h3 { margin-top: 1.5rem; margin-bottom: 0.75rem; font-size: 1.4rem; }
        .content p { margin-bottom: 1rem; }
        .content ul, .content ol { margin-left: 1.5rem; margin-bottom: 1rem; }
        .content li { margin-bottom: 0.5rem; }
        .content a { color: var(--primary); text-decoration: none; }
        .content a:hover { text-decoration: underline; }
        .content blockquote { border-left: 4px solid var(--primary); padding-left: 1rem; margin: 1.5rem 0; color: var(--muted); font-style: italic; }
        .content img { max-width: 100%; height: auto; border-radius: 8px; margin: 1rem 0; }
        .key-takeaways { background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; padding: 20px; margin: 24px 0; }
        .key-takeaways h3 { color: var(--primary); margin-bottom: 12px; }
        .key-takeaways ul { margin-left: 1.25rem; }
        .sources { background: #f8fafc; border-radius: 8px; padding: 20px; margin: 32px 0; }
        .sources h3 { margin-bottom: 12px; }
        .sources ul { list-style: none; margin: 0; }
        .sources li { margin-bottom: 8px; }
        .sources a { color: var(--primary); }
        .toc { background: #f9fafb; border-radius: 8px; padding: 20px; margin-bottom: 32px; }
        .toc h3 { margin-bottom: 12px; font-size: 1rem; color: var(--muted); }
        .toc ul { list-style: none; }
        .toc li { margin-bottom: 6px; }
        .toc a { color: var(--text); text-decoration: none; }
        .toc a:hover { color: var(--primary); }
        .preview-banner { background: #fef3c7; padding: 12px 20px; text-align: center; font-weight: 500; color: #92400e; }
        footer { border-top: 1px solid #e5e7eb; padding-top: 32px; margin-top: 48px; color: var(--muted); }
        @media (max-width: 768px) {
            h1 { font-size: 1.75rem; }
            .content { font-size: 1rem; }
        }
    </style>
</head>
<body>
    {% if is_preview %}
    <div class="preview-banner">
        ‚ö†Ô∏è Preview Mode - This post is not yet published
    </div>
    {% endif %}
    
    <div class="container">
        <article itemscope itemtype="https://schema.org/{{ schema_type }}">
            <header>
                <h1 itemprop="headline">{{ blog.title }}</h1>
                <div class="meta">
                    <span itemprop="author" itemscope itemtype="https://schema.org/Person">
                        By <span itemprop="name">{{ author_name }}</span>
                    </span>
                    <span>
                        <time itemprop="datePublished" datetime="{{ publish_date|date:'c' }}">{{ publish_date|date:"M d, Y" }}</time>
                    </span>
                    <span>{{ reading_time }}</span>
                    {% if category_name %}
                    <span itemprop="articleSection">{{ category_name }}</span>
                    {% endif %}
                </div>
            </header>
            
            {% if blog.image %}
            <img class="featured-image" 
                 src="{{ blog.get_image_url }}" 
                 alt="{{ blog.image_alt_text|default:blog.title }}"
                 itemprop="image"
                 loading="eager">
            {% if blog.image_caption %}
            <p style="text-align: center; color: var(--muted); font-size: 0.9rem; margin-top: -20px; margin-bottom: 24px;">
                {{ blog.image_caption }}
                {% if blog.image_credit %}<span> ‚Äî {{ blog.image_credit }}</span>{% endif %}
            </p>
            {% endif %}
            {% endif %}
            
            {% if toc and toc|length > 2 %}
            <nav class="toc" aria-label="Table of Contents">
                <h3>üìë In This Article</h3>
                <ul>
                {% for item in toc %}
                    <li><a href="#{{ item.slug }}">{{ item.text }}</a></li>
                {% endfor %}
                </ul>
            </nav>
            {% endif %}
            
            {% if key_takeaways %}
            <div class="key-takeaways">
                <h3>üîë Key Takeaways</h3>
                <ul>
                {% for takeaway in key_takeaways %}
                    <li>{{ takeaway }}</li>
                {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            <div class="content" itemprop="articleBody">
                {{ body_html|safe }}
            </div>
            
            {% if sources %}
            <div class="sources">
                <h3>üìö Sources & References</h3>
                <ul>
                {% for source in sources %}
                    <li>
                        <a href="{{ source.url }}" target="_blank" rel="noopener noreferrer">
                            {{ source.label }}
                        </a>
                        {% if source.type %}<small>({{ source.type }})</small>{% endif %}
                    </li>
                {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            {% if related_posts %}
            <footer>
                <h3>Related Articles</h3>
                <ul style="list-style: none; margin-top: 16px;">
                {% for post in related_posts %}
                    <li style="margin-bottom: 12px;">
                        <a href="/blog/{{ post.slug }}/" style="color: var(--primary);">{{ post.title }}</a>
                    </li>
                {% endfor %}
                </ul>
            </footer>
            {% endif %}
        </article>
    </div>
    
    <!-- Link hidden metadata -->
    <meta itemprop="url" content="{{ canonical_url }}">
    <meta itemprop="dateModified" content="{{ modified_date|date:'c' }}">
    <meta itemprop="wordCount" content="{{ word_count }}">
</body>
</html>
